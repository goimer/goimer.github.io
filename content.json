{"pages":[],"posts":[{"title":"怪猫讲Wireguard(一): 组建内网隧道","text":"文章采用系统版本：Centos 7.7 64 bit，本篇目的是使用两个公网机器组建内网，必要条件，至少要有一台有静态ipv4地址的机器充当网关。 1.简要说明wireguard可以说是目前最简单的内网穿透方案，类似的很多例如openvpn之列，相对来说配置较复杂点，另外，wireguard的服务端和客户端是相对的，已经安装的wireguard既可以充当客户端也可以充当服务端，重点在于配置。 2.安装wireguard1234567891011121314151617181920# 重要！！！先升级系统内核# 加入wireguard源sudo curl -Lo /etc/yum.repos.d/wireguard.repo https://copr.fedorainfracloud.org/coprs/jdoss/wireguard/repo/epel-7/jdoss-wireguard-epel-7.reposudo yum install epel-release -ysudo yum install wireguard-dkms wireguard-tools -y# 开启ipv4转发echo \"net.ipv4.ip_forward = 1\" &gt;&gt; /etc/sysctl.confsysctl -p# 创建Publickey和PrivateKeymkdir /etc/wireguardcd /etc/wireguardwg genkey | tee privatekey | wg pubkey &gt; publickeychmod 777 -R /etc/wireguard# 编辑配置文件(下面会贴仔细的)vi /etc/wireguard/wg0.conf# 创建开机自启并启动systemctl enable wg-quick@wg0wg-quick up wg0# 测试是否完成，理应显示为对面ipcurl zx2c4.com/ip 2.1 服务端配置123456789101112131415[Interface]# 为当前服务端分配的内网IPAddress = 10.0.0.1/24# 端口ListenPort = 56660PrivateKey = &lt; 这里填写 Server 上 privatekey 的内容 &gt;DNS = 8.8.8.8MTU = 1200# 如果你有多个客户端，追加多个peer就可以了[Peer]PublicKey = &lt; 这里填写 Client 上 publickey 的内容 &gt;# 哪些IP段可以访问内网AllowedIPs = 10.0.0.2/32 2.2客户端配置12345678910111213[Interface]PrivateKey = &lt; 这里填写 Client 上 privatekey 的内容 &gt;# 为当前客户端分配的内网IPAddress = 10.0.0.2/24MTU = 1200[Peer]PublicKey = &lt;这里填写 Server 上 publickey 的内容&gt;# 客户端哪些ip通过内网, 服务器慎重开启全局(有可能失联)# 如果你的客户端是你的电脑(开启全局设置 0.0.0.0/0即可)AllowedIPs = 10.0.0.0/24Endpoint = 服务器端的公网IP:端口PersistentKeepalive = 25 请注意，这种方案的优点在于，任何一台机器想要加入内网，只需要配置好客户端, 作为网关的服务器新增peer即可，但是缺点也很明显，AllowedIPs配置的IP段的任何流量都会经过网关节点，如果你要采用这种方案，请合理设计架构，当然你也可以灵活的相互配置，设立多个网关节点，保证线路不绕路。","link":"/2020/05/25/%E6%80%AA%E7%8C%AB%E8%AE%B2Wireguard-%E4%B8%80-%E7%BB%84%E5%BB%BA%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93/"}],"tags":[{"name":"Wireguard 内网隧道","slug":"Wireguard-内网隧道","link":"/tags/Wireguard-%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93/"}],"categories":[{"name":"网络","slug":"网络","link":"/categories/%E7%BD%91%E7%BB%9C/"}]}